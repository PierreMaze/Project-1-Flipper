const userDatabase = [
  {
    userid: 1,
    username: "Doe",
    firstname: "Jane",
    hachtag: "jane_doe",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 70,
    city: "Bordeaux",
  },
  {
    userid: 2,
    username: "Delion",
    firstname: "Jayson",
    hachtag: "jayson_delion",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 520,
    city: "Bordeaux",
  },
  {
    userid: 3,
    username: "Mazelaygue",
    firstname: "Pierre",
    hachtag: "pierre_mazelaygue",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 257,
    city: "Bordeaux",
  },
  {
    userid: 4,
    username: "Reillat",
    firstname: "Anthony",
    hachtag: "anthony_reillat",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 652,
    city: "Bordeaux",
  },
  {
    userid: 5,
    username: "Bourrier",
    firstname: "Gaitan",
    hachtag: "gaetan_bourrier",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 456,
    city: "Bordeaux",
  },
  {
    userid: 6,
    username: "Rodriguez",
    firstname: "Theo",
    hachtag: "theo_rodriguez",
    picture: "../src/img/assets/profilpic.jpg",
    followers: 70,
    city: "Villenave d'Ornon",
  },
];

const flipsDatabase = [
  {
    id: 1,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 2,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 3,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 4,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 5,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 6,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 7,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 8,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
  {
    id: 9,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti, tempora optio quam debitis ratione veritatis libero animi voluptates excepturi eveniet!",
    img: "../src/img/assets/profilpic.jpg",
    date: "10:05 AM - Dec 19, 2023",
    localisation: "Bordeaux",
    countmessage: 10,
    countflippers: 40,
    countdownvote: 70,
    countlikes: 80,
  },
];

const comments = [
  {
    id: 1,
    flipid: 1,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 2,
    flipid: 1,
    userid: 4,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 3,
    flipid: 1,
    userid: 3,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 4,
    flipid: 2,
    userid: 2,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 5,
    flipid: 2,
    userid: 1,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 6,
    flipid: 4,
    userid: 2,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 7,
    flipid: 4,
    userid: 5,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 8,
    flipid: 4,
    userid: 2,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 9,
    flipid: 5,
    userid: 5,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 10,
    flipid: 5,
    userid: 4,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 11,
    flipid: 5,
    userid: 2,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 12,
    flipid: 5,
    userid: 3,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 13,
    flipid: 4,
    userid: 3,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
  {
    id: 14,
    flipid: 6,
    userid: 5,
    content:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident, recusandae modi. Aliquam cumque alias qui repellendus delectus necessitatibus deleniti.",
  },
];

const mainWrapper = document.querySelector(".main-wrapper");

for (let i = 0; i < flipsDatabase.length; i += 1) {
  const j = flipsDatabase[i].userid - 1; /* Userdatabase */

  /* Create card element */
  const cardCreate = document.createElement("div");

  cardCreate.classList.add("card");
  cardCreate.id = `cardId_${flipsDatabase[i].id}`;

  /* Card Front */
  const cardFront = document.createElement("div");

  cardFront.classList.add("card__front");

  /* Card Header */
  const cardheader = document.createElement("div");

  cardheader.classList.add("card__header");

  const imgCardUserImage = document.createElement("div");
  imgCardUserImage.classList.add("card__user_image");
  imgCardUserImage.innerHTML = `<a href="../index.html" target="_blank" rel="noopener"><img src="../src/img/assets/profilpic.jpg" alt="Picture profil"></a>`;

  cardheader.appendChild(imgCardUserImage);

  const cardUser = document.createElement("div");
  cardUser.classList.add("card__user");

  const cardUserName = document.createElement("h2");
  cardUserName.classList.add("card__user_name");
  cardUserName.textContent = `${userDatabase[j].firstname} ${userDatabase[j].username}`;

  const cardUserHash = document.createElement("h3");
  cardUserHash.classList.add("card__user_hash");
  cardUserHash.textContent = `@ ${userDatabase[
    j
  ].firstname.toLowerCase()}_${userDatabase[j].username.toLowerCase()}`;

  cardUser.appendChild(cardUserName);
  cardUser.appendChild(cardUserHash);

  cardheader.appendChild(cardUser);

  cardFront.appendChild(cardheader);

  /* Card Content */
  const cardContent = document.createElement("div");
  cardContent.classList.add("card__content");

  const cardContentText = document.createElement("div");
  cardContentText.classList.add("card__content_text");
  cardContentText.textContent = `${flipsDatabase[i].content}`;

  cardContent.appendChild(cardContentText);

  if (flipsDatabase[i].img !== "") {
    const cardContentImage = document.createElement("div");
    cardContentImage.classList.add("card__content_image");

    const imgCardContentImage = document.createElement("img");
    imgCardContentImage.src = `${flipsDatabase[i].img}`;
    imgCardContentImage.alt = "Profil picture";

    cardContentImage.appendChild(imgCardContentImage);
    cardContent.appendChild(cardContentImage);
  }

  const cardContentTime = document.createElement("div");
  cardContentTime.classList.add("card__date_time");
  cardContentTime.textContent = `${flipsDatabase[i].date}`;

  cardContent.appendChild(cardContentTime);

  cardFront.appendChild(cardContent);

  /* Div Bar */
  const cardBar = document.createElement("div");
  cardBar.classList.add("card__bar");

  cardFront.appendChild(cardBar);

  /* Card actions */
  const cardActionConteneur = document.createElement("div");
  cardActionConteneur.classList.add("card__actions");

  /* Likes */
  const cardActionLikes = document.createElement("div");
  cardActionLikes.classList.add("actions__likes");

  cardActionLikes.innerHTML = '<i class="fa-regular fa-heart fa-lg"></i>';

  const numberLikes = document.createElement("p");
  numberLikes.classList.add("number_likes");
  numberLikes.innerText = `${flipsDatabase[i].countlikes}`;

  cardActionLikes.appendChild(numberLikes);

  /* Downvotes */
  const cardActionDownvotes = document.createElement("div");
  cardActionDownvotes.classList.add("actions__downvotes");
  cardActionDownvotes.innerHTML =
    '<i class="fa-regular fa-thumbs-down fa-lg"></i>';

  const numberDownvotes = document.createElement("p");
  numberDownvotes.classList.add("number_downvotes");
  numberDownvotes.innerText = `${flipsDatabase[i].countdownvote}`;

  cardActionDownvotes.appendChild(numberDownvotes);

  /* Messages */

  const cardActionsMessages = document.createElement("div");
  cardActionsMessages.classList.add("actions__messages");
  cardActionsMessages.innerHTML = '<i class="fa-regular fa-message fa-lg"></i>';

  const numberMessages = document.createElement("p");
  numberMessages.classList.add("number_messages");
  numberMessages.innerText = `${flipsDatabase[i].countmessage}`;

  cardActionsMessages.appendChild(numberMessages);

  /* Reply */
  const cardActionReply = document.createElement("div");
  cardActionReply.classList.add("actions__reply");
  cardActionReply.innerHTML =
    '<img src="../src/img/ico/download.svg" alt="Dolphine Icon" srcset="" class="fa-dolphine">';

  const numberReply = document.createElement("p");
  numberReply.classList.add("actions__reply");
  numberReply.innerText = `${flipsDatabase[i].countflippers}`;

  cardActionReply.appendChild(numberReply);

  /* Add section message */

  const cardComments = document.createElement("div");
  cardComments.classList.add("card__comments");
  cardComments.classList.add("is-colapsed");

  const moreComments = document.createElement("button");
  moreComments.classList.add("comments_collapse");
  moreComments.innerText = "See more comments...";
  cardComments.appendChild(moreComments);

  const commentsList = document.createElement("div");
  commentsList.classList.add("comments_list");
  const commentsDiv = document.createElement("div");
  commentsDiv.classList.add("comments");

  let nbComments = 0;

  for (let k = 0; k < comments.length; k += 1) {
    if (flipsDatabase[i].id === comments[k].flipid) {
      const l = comments[k].userid - 1;

      const commentText = document.createElement("div");
      commentText.classList.add("comments_text");

      const imgPicture = document.createElement("img");
      imgPicture.classList.add("profil-picture");
      imgPicture.src = `${userDatabase[l].picture}`;
      imgPicture.alt = "Picture Profil";
      commentText.appendChild(imgPicture);

      const commentUser = document.createElement("comment_user");
      commentUser.classList.add("comment_user");
      const userCommentName = document.createElement("h3");
      userCommentName.classList.add("user_comment_name");
      userCommentName.innerText = `${userDatabase[l].firstname} ${userDatabase[l].username}`;
      commentUser.appendChild(userCommentName);
      const userComment = document.createElement("p");
      userComment.classList.add("user_comment");
      userComment.innerText = `${comments[k].content}`;
      commentUser.appendChild(userComment);
      commentText.appendChild(commentUser);
      commentsDiv.appendChild(commentText);

      nbComments += 1;
    }
  }
  numberMessages.textContent = nbComments;
  if (parseInt(numberMessages.textContent, 10) === 0) {
    moreComments.classList.add("is-colapsed");
  }

  commentsList.appendChild(commentsDiv);
  cardComments.appendChild(commentsList);

  const inputComment = document.createElement("div");
  inputComment.classList.add("input_comment");

  const imgPictureUser = document.createElement("img");
  imgPictureUser.classList.add("profil-picture");
  imgPictureUser.src = `../src/img/assets/profilpic.jpg`;
  imgPictureUser.alt = "Picture Profil";
  inputComment.appendChild(imgPictureUser);

  const textAreaComment = document.createElement("textarea");
  textAreaComment.classList.add("textarea_comment");
  inputComment.appendChild(textAreaComment);

  const btnSend = document.createElement("button");
  btnSend.classList.add("btn");
  btnSend.classList.add("btn-rounded");
  btnSend.classList.add("btn-primary");
  btnSend.classList.add("btn-msg-send");
  btnSend.innerHTML = '<i class="fa-regular fa-paper-plane"></i>';

  inputComment.appendChild(btnSend);
  cardComments.appendChild(inputComment);

  /* Appendchild to Action conteneur */
  cardActionConteneur.appendChild(cardActionLikes);
  cardActionConteneur.appendChild(cardActionDownvotes);
  cardActionConteneur.appendChild(cardActionsMessages);
  cardActionConteneur.appendChild(cardActionReply);

  cardFront.appendChild(cardActionConteneur);
  cardFront.appendChild(cardComments);

  cardCreate.appendChild(cardFront);

  mainWrapper.appendChild(cardCreate);

  const commentsDivAll = commentsList.querySelectorAll(
    ".comments_text:not(:last-child)"
  );
  commentsDivAll.forEach((comment) => {
    comment.classList.add("is-colapsed");
  });
}

function updateLikesCount(likeIcon) {
  const numberLikes = likeIcon.parentElement.querySelector(".number_likes");
  let likesCount = parseInt(numberLikes.textContent, 10);

  if (likeIcon.classList.contains("is-active")) {
    likesCount -= 1;
    likeIcon.classList.remove("is-active");
  } else {
    likesCount += 1;
    likeIcon.classList.add("is-active");
  }

  numberLikes.textContent = likesCount;
}

function handleLikeClick() {
  const likeIcons = document.querySelectorAll(".fa-heart");
  likeIcons.forEach((likeIcon) => {
    likeIcon.addEventListener("click", () => {
      updateLikesCount(likeIcon);
    });
  });
}

function updateDownvoteCount(downvoteIcons) {
  const numberDownvotes =
    downvoteIcons.parentElement.querySelector(".number_downvotes");
  let downvoteCount = parseInt(numberDownvotes.textContent, 10);

  if (downvoteIcons.classList.contains("is-active")) {
    downvoteCount -= 1;
    downvoteIcons.classList.remove("is-active");
  } else {
    downvoteCount += 1;
    downvoteIcons.classList.add("is-active");
  }

  numberDownvotes.textContent = downvoteCount;
}

function handleDownvoteClick() {
  const downvoteIcons = document.querySelectorAll(".fa-thumbs-down");
  downvoteIcons.forEach((downvoteIcon) => {
    downvoteIcon.addEventListener("click", () => {
      updateDownvoteCount(downvoteIcon);
    });
  });
}

function updateCommentsCount(commentIcons) {
  const commentsCard =
    commentIcons.parentElement.parentElement.parentElement.querySelector(
      ".card__comments"
    );
  commentsCard.classList.toggle("is-collapsed");
}

function handleCommentsClick() {
  const commentIcons = document.querySelectorAll(".actions__messages i");
  commentIcons.forEach((commentIcon) => {
    commentIcon.addEventListener("click", () => {
      updateCommentsCount(commentIcon);
    });
  });
}

function toggleCommentCollapse(parentComments) {
  const commentChild = parentComments.querySelectorAll(
    ".comments_text:not(:last-child)"
  );
  commentChild.forEach((el) => {
    el.classList.toggle("is-colapsed");
  });
}

function handleCommentCollapseClick(expandMessage) {
  expandMessage.addEventListener("click", () => {
    const parentComments = expandMessage.closest(".card__comments");
    toggleCommentCollapse(parentComments);
  });
}

function setupCommentCollapse() {
  const expandMessage = document.querySelectorAll(".comments_collapse");
  expandMessage.forEach((element) => {
    handleCommentCollapseClick(element);
  });
}

function toggleCardComments(clickedElement) {
  const cardCommentParent = clickedElement
    .closest(".card__front")
    .querySelector(".card__comments");
  cardCommentParent.classList.toggle("is-colapsed");
}

function setupCardCommentsToggle() {
  const addComment = document.querySelectorAll(".fa-message");
  addComment.forEach((el) => {
    el.addEventListener("click", () => {
      toggleCardComments(el);
    });
  });
}

function addCommentOnClick(button) {
  const textareaSibling = button
    .closest(".input_comment")
    .querySelector(".textarea_comment");
  const commentValue = textareaSibling.value;

  if (commentValue !== "") {
    const commentsListClosest = button
      .closest(".card__comments")
      .querySelector(".comments");
    const commentText = document.createElement("div");
    commentText.classList.add("comments_text");

    const imgPicture = document.createElement("img");
    imgPicture.classList.add("profil-picture");
    imgPicture.src = `../src/img/assets/profilpic.jpg`;
    imgPicture.alt = "Picture Profil";
    commentText.appendChild(imgPicture);

    const commentUser = document.createElement("comment_user");
    commentUser.classList.add("comment_user");
    const userCommentName = document.createElement("h3");
    userCommentName.classList.add("user_comment_name");
    userCommentName.innerText = `John Doe`;
    commentUser.appendChild(userCommentName);
    const userComment = document.createElement("p");
    userComment.classList.add("user_comment");
    userComment.innerText = `${commentValue}`;
    commentUser.appendChild(userComment);
    commentText.appendChild(commentUser);
    commentsListClosest.appendChild(commentText);
    textareaSibling.value = "";
  }
}

function addClickEventToButtons() {
  const btnMsgSend = document.querySelectorAll(".btn-msg-send");
  btnMsgSend.forEach((button) => {
    button.addEventListener("click", () => {
      addCommentOnClick(button);
    });
  });
}

function actualizeFeed() {
  handleLikeClick();
  handleDownvoteClick();
  handleCommentsClick();
  setupCommentCollapse();
  setupCardCommentsToggle();
  addClickEventToButtons();
}

actualizeFeed();
